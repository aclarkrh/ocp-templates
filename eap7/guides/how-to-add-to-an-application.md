# How to add the template components to your application

## Overview of Steps
The template components are applied by following these steps:
- Copy the following directories and their contents from this repository to the root directory of your appication source code:
  - `src/config`
  - `.s2i`
  - `configuration`
- Either edit the copied `configuration/settings.xml` file to meet your application's Maven repository requirements or replace it with your pre-existing `settings.xml` file.
- Edit your application POM file to include the contents of `pom.xml.snippets` in this repository.
- Customise the template components to suit your application configuration requirements.

## Customising your application
### pom.xml
When the contents of `pom.xml.snippets` are copied into your application's POM file, the majority of the additional configuration is contained within a new profile named 'kube-dsl'. This profile has a number of properties that need to be configured for your application. All properties (and other values) that need to be configured are surrounded by three underscores, e.g.
"\_\_\_INSERT\_GIT\_REPO\_URL\_\_\_". This means that you can find all of these parameters simply by searching for "\_\_\_" in the POM file.

There are a number of parameters that will be commonly required by applications. They are described in the table below. Parameters can be added or removed as required for each application.

Parameter | Purpose
--------- | -------
GIT_URI | URI to the Git repository where the s2i scripts are located. This is used during the s2i build process to pull the scripts so that they can be used to curl the application binary (e.g. WAR file) into the image.<br><br>As the s2i scripts are located in the same repository as the application, this should be the URI for the application's Git repository.
SOURCE_REPOSITORY_REF | This is the Git branch that the s2i scripts should be pulled from.<br><br>This should be the same branch that the application binary is being built from to ensure that the binary and OCP configuration are aligned.
CONTEXT_DIR | Allows the path within the Git repo where the s2i scripts are located to be specified.<br><br>By default the template location for these scripts in the root of the repository so no value is required.
SOURCE_SECRET | The name of the OCP secret containing the Git credentials that should be used to pull the s2i scripts. The secret needs to be created in the OCP `<app-name>-bld` namespace before deploying the application to the OCP environment.
WAR_FILE_URL | This URL is used by the s2i `assemble` script to curl the application binary (e.g. WAR file) and output the binary to EAP's deployment directory within the built container image.<br><br>As Artifactory is used to store application binaries, this URL should point to the location of the application binaries in Artifactory but should also be parameterised to allow the artefact Id and version to be replaced with values from the POM.
APPLICATION_NAME | The name of the application.<br><br>Parameterised and populated from the POM artefact Id.
APPLICATION_VERSION | The version of the application.<br><br>Parameterised and populated from the POM version.
HOSTNAME_HTTP | Provided to allow customisation of the HTTP route hostname.<br><br>In most cases the default hostname generated by OCP will be used, leave blank for default hostname, e.g.: &lt;application-name&gt;-&lt;project&gt;.&lt;default-domain-suffix&gt;
HOSTNAME_HTTPS | Provided to allow customisation of HTTPS route hostname.<br><br>In most cases the default hostname generated by OCP will be used, leave blank for default hostname, e.g.: &lt;application-name&gt;-&lt;project&gt;.&lt;default-domain-suffix&gt;
XPAAS_IS_PULL_NAMESPACE | The OCP project where the xPaaS ImageStreams are installed and will be pulled from for the s2i build of the application.<br><br>This is usually the standard OCP project name 'openshift'.
XPAAS_IS_NAME | The name of the xPaaS Image that the application uses for the s2i build.
XPAAS_IS_TAG | The tag (version) of the xPaaS image that the application uses for the s2i build.
APP_IS_PULL_NAMESPACE | Project where the application ImageStreams are created. Used by the deployment config to pull the application container image.<br><br>Should be the name of the application's build namespace, `<app-name>-bld`.
PERSISTENT_VOLUME_CLAIM_SIZE | If the application requires a PVC this parameter can be used to specify the size of the PVC required.
PERSISTENT_VOLUME_MOUNT_PATH | If the application requires a PVC this parameter can be used to specify the path where the PVC should be mounted.
READINESS_PROBE_PATH | The path to probe for the HTTP readiness check. This should be a URL that returns a status code of 200 when the application has fully started. This could be a specifically created path or a part of the application that can be repeatedly probed without impacting the application, e.g. a read-only index page. You should consider a URL that proves parts of your application are ready, such as causing a read from the databse.
LIVENESS_PROBE_PATH | The path to probe for the HTTP liveness check. This should be a URL that returns a status code of 200 when the application is in a healthy state. This could be a specifically created path or a part of the application that can be repeatedly probed without impacting the application, e.g. a read-only index page. You should consider a URL that proves parts of your application are healthy, such as causing a read from the databse.
CPU_REQUEST | The requested CPU resource. This will be used as the minimum CPU resource required for a pod instance when scheduling pods to nodes.
MEM_REQUEST | The requested memory resource. This will be used as the minimum memory resource required for a pod instance when scheduling pods to nodes.
CPU_LIMIT | The CPU resource limit. This will be used as an upper limit for CPU resource that can be consumed by a pod instance.
MEM_LIMIT | The memory resource limit. This will be used as an upper limit for memory resource that can be consumed by a pod instance.

The CPU/memory request/limit parameters should be tuned to provide the required balance between application performance and resource consumption. This is likely to differ between applications.

### Customising the Template Components

The template components will generate OpenShift (Kubernetes) configuration for your application. Because each application is different, this configuration will need to be specific to your application which is acheived by modifying the template components.

Before modifying the compoments you should have an understanding of how they work, which is described in the [Template Components Guide](template-components-guide.md).

The template includes (or will do once fully developed) at least one configuration for common patterns, e.g. a database connection. If multiple instances of a pattern are required by your application, the sample configuration can be duplicated for additional instances.
